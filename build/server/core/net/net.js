// Generated by CoffeeScript 1.9.3
var Net, ws;

ws = new require('ws');

Net = {
  start: function() {
    Net.server = new ws.Server({
      port: Net.port
    });
    return Net.server.on('connection', function(socket) {
      Net.event.connect(socket);
      socket.on('message', function(data) {
        switch (Net.mask(new Uint8Array(data, 0, 1)[0])) {
          case 'ping':
            return socket.ping = Date.now() - Net.command.ping.lastTime;
        }
      });
      return socket.on('close', function() {
        return Net.event.disconnect(socket);
      });
    });
  },
  mask: function(a) {
    var k, masks, v;
    masks = {
      'ping': 0,
      'sync': 1,
      'fullSync': 2
    };
    switch (typeof a) {
      case 'string':
        return masks[a];
      case 'number':
        for (k in masks) {
          v = masks[k];
          masks[v] = k;
        }
        return masks[a];
    }
  },
  port: 10101,
  server: null,
  clients: {},
  event: {},
  command: {}
};
